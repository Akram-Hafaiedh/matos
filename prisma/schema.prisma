generator client {
  provider = "prisma-client-js"
  output   = "../app/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model accounts {
  id                  String  @id
  user_id             String
  type                String
  provider            String
  provider_account_id String
  refresh_token       String?
  access_token        String?
  expires_at          Int?
  token_type          String?
  scope               String?
  id_token            String?
  session_state       String?
  users               User    @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@unique([provider, provider_account_id])
}

model cart_sessions {
  id           String   @id
  user_id      String?
  session_data Json
  expires_at   DateTime
  created_at   DateTime @default(now())
  users        User?    @relation(fields: [user_id], references: [id], onDelete: Cascade)
}

model categories {
  id            Int          @id @default(autoincrement())
  name          String       @db.VarChar(255)
  emoji         String?      @db.VarChar(10)
  display_order Int          @default(0)
  show_in_hero  Boolean      @default(false)
  hero_title    String?      @db.VarChar(255)
  hero_subtitle String?
  hero_color    String?      @db.VarChar(100)
  is_active     Boolean      @default(true)
  created_at    DateTime     @default(now())
  menu_items    menu_items[]
}

model contact_messages {
  id         Int      @id @default(autoincrement())
  name       String   @db.VarChar(255)
  email      String   @db.VarChar(255)
  phone      String?  @db.VarChar(20)
  subject    String   @db.VarChar(255)
  message    String
  status     String   @default("unread") @db.VarChar(50)
  created_at DateTime @default(now())
}

model global_settings {
  id               Int      @id @default(1)
  address          String   @default("2015, 1 Rue Abderrazak Karabaka, Carthage") @db.VarChar(255)
  phone            String   @default("99 956 608") @db.VarChar(50)
  lat              Float    @default(36.8391)
  lng              Float    @default(10.3200)
  facebook         String?  @db.VarChar(255)
  instagram        String?  @db.VarChar(255)
  tiktok           String?  @db.VarChar(255)
  whatsapp         String?  @db.VarChar(50)
  updated_at       DateTime
  google_maps_url  String?
  stamp_duty       Float    @default(1.0)
  vat_rate         Float    @default(0.19)
  invoice_template String   @default("standard") @db.VarChar(50)
}

model menu_items {
  id             Int           @id @default(autoincrement())
  name           String        @db.VarChar(255)
  description    String?
  price          Json
  original_price Float?
  category_id    Int?
  image_url      String?       @db.VarChar(500)
  emoji          String?       @db.VarChar(10)
  ingredients    String[]
  popular        Boolean       @default(false)
  bestseller     Boolean       @default(false)
  hot            Boolean       @default(false)
  discount       Int?
  sauce          String?       @db.VarChar(50)
  is_active      Boolean       @default(true)
  created_at     DateTime      @default(now())
  updated_at     DateTime
  display_order  Int           @default(0)
  categories     categories?   @relation(fields: [category_id], references: [id])
  menu_likes     menu_likes[]
  order_items    order_items[]
  reviews        reviews[]
}

model menu_likes {
  id           Int        @id @default(autoincrement())
  user_id      String
  menu_item_id Int
  created_at   DateTime   @default(now())
  menu_items   menu_items @relation(fields: [menu_item_id], references: [id], onDelete: Cascade)
  users        User       @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@unique([user_id, menu_item_id])
}

model notifications {
  id         Int      @id @default(autoincrement())
  user_id    String
  title      String   @db.VarChar(255)
  message    String
  type       String   @db.VarChar(50)
  link       String?  @db.VarChar(255)
  is_read    Boolean  @default(false)
  created_at DateTime @default(now())
  users      User     @relation(fields: [user_id], references: [id], onDelete: Cascade)
}

model order_items {
  id            Int         @id @default(autoincrement())
  order_id      Int
  menu_item_id  Int?
  item_name     String      @db.VarChar(255)
  item_price    Float
  quantity      Int         @default(1)
  selected_size String?     @db.VarChar(50)
  notes         String?
  created_at    DateTime    @default(now())
  choices       Json?
  promotion_id  Int?
  menu_items    menu_items? @relation(fields: [menu_item_id], references: [id])
  orders        orders      @relation(fields: [order_id], references: [id], onDelete: Cascade)
  promotions    promotions? @relation(fields: [promotion_id], references: [id])
}

model orders {
  id                            Int               @id @default(autoincrement())
  order_number                  String            @unique @db.VarChar(50)
  user_id                       String?
  customer_name                 String            @db.VarChar(255)
  customer_phone                String            @db.VarChar(20)
  customer_email                String?           @db.VarChar(255)
  delivery_address              String
  city                          String            @default("Tunis") @db.VarChar(100)
  notes                         String?
  delivery_time                 String            @default("asap") @db.VarChar(50)
  scheduled_time                DateTime?
  payment_method                String            @default("cash") @db.VarChar(50)
  subtotal                      Float
  delivery_fee                  Float             @default(0)
  total_amount                  Float
  status                        String            @default("pending") @db.VarChar(50)
  order_date                    DateTime          @default(now())
  delivered_at                  DateTime?
  created_at                    DateTime          @default(now())
  updated_at                    DateTime
  cancelled_at                  DateTime?
  confirmed_at                  DateTime?
  out_for_delivery_at           DateTime?
  preparing_at                  DateTime?
  ready_at                      DateTime?
  order_type                    String            @default("delivery") @db.VarChar(50)
  cancel_message                String?
  points_awarded                Boolean           @default(false)
  lat                           Float?
  lng                           Float?
  estimated_delivery_confidence String?           @db.VarChar(50)
  estimated_total_time          Int?
  estimated_travel_time         Int?
  estimated_prep_time           Int?
  actual_delivery_time          DateTime?
  order_items                   order_items[]
  users                         User?             @relation(fields: [user_id], references: [id])
  support_tickets               support_tickets[]
}

model promotions {
  id              Int           @id @default(autoincrement())
  name            String        @db.VarChar(255)
  description     String?
  price           Float?
  original_price  Float?
  discount        Int?
  image_url       String?       @db.VarChar(500)
  emoji           String?       @db.VarChar(10)
  badge_text      String?       @db.VarChar(50)
  badge_color     String?       @db.VarChar(50)
  is_active       Boolean       @default(true)
  start_date      DateTime?
  end_date        DateTime?
  conditions      String?
  created_at      DateTime      @default(now())
  selection_rules Json?
  is_hot          Boolean       @default(false)
  tag             String?       @db.VarChar(100)
  order_items     order_items[]
}

model quests {
  id                String        @id
  title             String
  description       String
  type              String
  emoji             String?
  created_at        DateTime      @default(now())
  is_active         Boolean       @default(true)
  min_act           Int           @default(0)
  reward_amount     Int           @default(0)
  reward_type       String        @default("tokens")
  updated_at        DateTime      @default(now()) @updatedAt
  validation_config Json?
  user_quests       user_quests[]
}

model reviews {
  id           Int        @id @default(autoincrement())
  user_id      String
  menu_item_id Int
  rating       Int        @default(5)
  comment      String?
  created_at   DateTime   @default(now())
  show_on_home Boolean    @default(false)
  menu_items   menu_items @relation(fields: [menu_item_id], references: [id])
  users        User       @relation(fields: [user_id], references: [id])
}

model sessions {
  id            String   @id
  session_token String   @unique
  user_id       String
  expires       DateTime
  users         User     @relation(fields: [user_id], references: [id], onDelete: Cascade)
}

model shop_items {
  id          String   @id
  name        String
  type        String
  price       Int
  act         Int      @default(1)
  level       Int      @default(1)
  rarity      String
  emoji       String
  metadata    Json?
  description String?
  multiplier  Float    @default(1.0)
  boost_type  String?
  created_at  DateTime @default(now())
  is_active   Boolean  @default(true)
  updated_at  DateTime @default(now()) @updatedAt
}

model support_tickets {
  id                   Int               @id @default(autoincrement())
  user_id              String?
  order_id             Int?
  subject              String            @db.VarChar(255)
  description          String
  status               String            @default("open") @db.VarChar(50)
  priority             String            @default("medium") @db.VarChar(20)
  created_at           DateTime          @default(now())
  updated_at           DateTime
  last_admin_typing_at DateTime?
  last_user_typing_at  DateTime?
  orders               orders?           @relation(fields: [order_id], references: [id])
  users                User?             @relation(fields: [user_id], references: [id])
  ticket_messages      ticket_messages[]
}

model ticket_messages {
  id              Int             @id @default(autoincrement())
  ticket_id       Int
  user_id         String
  message         String
  is_admin        Boolean         @default(false)
  created_at      DateTime        @default(now())
  attachments     Json?
  support_tickets support_tickets @relation(fields: [ticket_id], references: [id], onDelete: Cascade)
  users           User            @relation(fields: [user_id], references: [id])
}

model user_inventory {
  id          String    @id
  user_id     String
  item_id     String
  name        String
  type        String
  unlocked_at DateTime  @default(now())
  expires_at  DateTime?
  description String?
  users       User      @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@unique([user_id, item_id])
}

model user_quests {
  id               String    @id
  user_id          String
  quest_id         String
  progress         Int       @default(0)
  status           String    @default("IN_PROGRESS")
  last_progress_at DateTime  @default(now())
  completed_at     DateTime?
  quests           quests    @relation(fields: [quest_id], references: [id], onDelete: Cascade)
  users            User      @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@unique([user_id, quest_id])
}

model User {
  id              String            @id
  name            String?
  email           String?           @unique
  email_verified  DateTime?
  password        String?           @db.VarChar(255)
  image           String?
  phone           String?           @db.VarChar(20)
  address         String?
  role            String            @default("customer") @db.VarChar(50)
  created_at      DateTime          @default(now())
  updated_at      DateTime          @updatedAt
  loyalty_points  Int               @default(0)
  selected_frame  String?
  selected_bg     String?
  tokens          Int               @default(0)
  selected_title  String?
  accounts        accounts[]
  cart_sessions   cart_sessions[]
  menu_likes      menu_likes[]
  notifications   notifications[]
  orders          orders[]
  reservations    reservations[]
  reviews         reviews[]
  sessions        sessions[]
  support_tickets support_tickets[]
  ticket_messages ticket_messages[]
  inventory       user_inventory[]
  user_quests     user_quests[]

  @@map("users")
}

model reservations {
  id               Int      @id @default(autoincrement())
  user_id          String?
  customer_name    String   @db.VarChar(255)
  customer_phone   String   @db.VarChar(50)
  customer_email   String?  @db.VarChar(255)
  reservation_date DateTime
  party_size       Int      @default(2)
  status           String   @default("pending") @db.VarChar(50)
  notes            String?
  table_number     Int?
  created_at       DateTime @default(now())
  updated_at       DateTime @updatedAt
  users            User?    @relation(fields: [user_id], references: [id])
}

model verification_tokens {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
}

model hero_slides {
  id         Int      @id @default(autoincrement())
  title      String   @db.VarChar(255)
  subtitle   String   @db.VarChar(255)
  tagline    String
  image_url  String   @db.VarChar(500)
  accent     String   @default("from-yellow-400 to-orange-600") @db.VarChar(100)
  order      Int      @default(0)
  is_active  Boolean  @default(true)
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt
}

model content_pages {
  id         Int      @id @default(autoincrement())
  slug       String   @unique @db.VarChar(100)
  title      String   @db.VarChar(255)
  subtitle   String?
  content    Json
  updated_at DateTime @updatedAt
}

model email_settings {
  id         Int      @id @default(1)
  host       String   @default("smtp.gmail.com") @db.VarChar(255)
  port       Int      @default(587)
  user       String   @default("") @db.VarChar(255)
  password   String   @default("") @db.VarChar(255)
  from_email String   @default("hello@matos.tn") @db.VarChar(255)
  from_name  String   @default("Mato's") @db.VarChar(255)
  encryption String   @default("TLS") @db.VarChar(20)
  updated_at DateTime @updatedAt
  is_active  Boolean  @default(true)
}

model sms_settings {
  id         Int      @id @default(1)
  provider   String   @default("simulator") @db.VarChar(50)
  api_key    String?  @db.VarChar(255)
  api_secret String?  @db.VarChar(255)
  sender_id  String?  @db.VarChar(50)
  is_active  Boolean  @default(false)
  updated_at DateTime @updatedAt
}

model sent_emails {
  id         Int      @id @default(autoincrement())
  to         String   @db.VarChar(255)
  subject    String   @db.VarChar(255)
  content    String
  status     String   @default("sent") @db.VarChar(50)
  created_at DateTime @default(now())
}

model geocoding_stats {
  id       Int      @id @default(autoincrement())
  provider String   @db.VarChar(50)
  date     DateTime @default(now()) @db.Date
  count    Int      @default(0)

  @@unique([provider, date])
}
